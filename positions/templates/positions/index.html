{% extends "home/base.html" %}
{% load static %}

{% block title %}Positions{% endblock %}


{% block extra_head %}

    <style>


        .dataframe {
            margin: 25px 40px 70px 60px;
            width: 90%
        }

        #dropdown_accounts {
            margin: 0 0 0 60px;
            width: 20%;
            height: 120px
        }

    </style>

{% endblock %}

{% block content %}

    <select multiple="multiple" name="accounts[]" id="dropdown_accounts" class="form-control">
        {% for acct in accounts %}
            <option value="{{ acct }}" class="form-control">{{ acct }}</option>
        {% endfor %}
    </select>

    {{ positions|safe }}

    <script>

        $(document).ready(function() {


            // Handling totals row for sorting purposes:

            // Find totals row
            var totalsRow = $(".dataframe td").filter(function() {
                return $(this).text() == "Totals";
            }).closest("tr");

            // Detach totals row and create tfoot element from it
            var totalsRow = totalsRow.detach();
            var totalsHtml = "<tfoot>" + totalsRow.html() + "</tfoot>";

            // Append tfoot to tbody
            $(".dataframe tbody").after(totalsHtml);

        });

    </script>

    <script>

        // filter rows by account

        $('#dropdown_accounts').change(function() {
            var filter_accounts = Array();

            $('#dropdown_accounts').children('option').filter(':selected').each(
                function(i) {
                  filter_accounts.push($(this).text());
            })

            console.log(filter_accounts);

            $('.dataframe tbody tr').each(function(){
                var row = $(this);
                var account = row.children('td').last().text();

                // reset all to display
                row.css("display", "table-row");

                // hide the filtered accounts
                if( $.inArray(account, filter_accounts) == -1 ){
                    row.css("display", "none");
                }
            })

        });


    </script>

{% endblock %}
